import { PCG815_DISPLAY_SPEC } from './hardware-map';

export const LCD_WIDTH = PCG815_DISPLAY_SPEC.width;
export const LCD_HEIGHT = PCG815_DISPLAY_SPEC.height;
export const LCD_COLS = PCG815_DISPLAY_SPEC.textCols;
export const LCD_ROWS = PCG815_DISPLAY_SPEC.textRows;
export const LCD_GLYPH_WIDTH = PCG815_DISPLAY_SPEC.glyphWidth;
export const LCD_GLYPH_HEIGHT = PCG815_DISPLAY_SPEC.glyphHeight;
export const LCD_GLYPH_PITCH_X = PCG815_DISPLAY_SPEC.glyphPitchX;
export const LCD_GLYPH_PITCH_Y = PCG815_DISPLAY_SPEC.glyphPitchY;

function row(bits: string): number {
  return Number.parseInt(bits, 2) & 0x1f;
}

function glyph(...rows: string[]): Uint8Array {
  return Uint8Array.from(rows.map((bits) => row(bits)));
}

const GLYPHS = new Map<number, Uint8Array>([
  [0x20, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0x21, glyph('00100', '00100', '00100', '00100', '00100', '00000', '00100')],
  [0x22, glyph('01010', '01010', '01010', '00000', '00000', '00000', '00000')],
  [0x23, glyph('01010', '11111', '01010', '01010', '11111', '01010', '00000')],
  [0x24, glyph('00100', '01111', '10100', '01110', '00101', '11110', '00100')],
  [0x25, glyph('11001', '11010', '00100', '01000', '10110', '00110', '00000')],
  [0x26, glyph('01100', '10010', '10100', '01000', '10101', '10010', '01101')],
  [0x27, glyph('00100', '00100', '00010', '00000', '00000', '00000', '00000')],
  [0x28, glyph('00010', '00100', '01000', '01000', '01000', '00100', '00010')],
  [0x29, glyph('01000', '00100', '00010', '00010', '00010', '00100', '01000')],
  [0x2a, glyph('00000', '01010', '00100', '11111', '00100', '01010', '00000')],
  [0x2b, glyph('00000', '00100', '00100', '11111', '00100', '00100', '00000')],
  [0x2c, glyph('00000', '00000', '00000', '00000', '00000', '00100', '01000')],
  [0x2d, glyph('00000', '00000', '00000', '11111', '00000', '00000', '00000')],
  [0x2e, glyph('00000', '00000', '00000', '00000', '00000', '00100', '00100')],
  [0x2f, glyph('00001', '00010', '00100', '01000', '10000', '00000', '00000')],
  [0x30, glyph('01110', '10001', '10011', '10101', '11001', '10001', '01110')],
  [0x31, glyph('00100', '01100', '00100', '00100', '00100', '00100', '01110')],
  [0x32, glyph('01110', '10001', '00001', '00010', '00100', '01000', '11111')],
  [0x33, glyph('11110', '00001', '00001', '01110', '00001', '00001', '11110')],
  [0x34, glyph('00010', '00110', '01010', '10010', '11111', '00010', '00010')],
  [0x35, glyph('11111', '10000', '10000', '11110', '00001', '00001', '11110')],
  [0x36, glyph('01110', '10000', '10000', '11110', '10001', '10001', '01110')],
  [0x37, glyph('11111', '00001', '00010', '00100', '01000', '01000', '01000')],
  [0x38, glyph('01110', '10001', '10001', '01110', '10001', '10001', '01110')],
  [0x39, glyph('01110', '10001', '10001', '01111', '00001', '00001', '01110')],
  [0x3a, glyph('00000', '00100', '00100', '00000', '00100', '00100', '00000')],
  [0x3b, glyph('00000', '00100', '00100', '00000', '00100', '00100', '01000')],
  [0x3c, glyph('00010', '00100', '01000', '10000', '01000', '00100', '00010')],
  [0x3d, glyph('00000', '11111', '00000', '11111', '00000', '00000', '00000')],
  [0x3e, glyph('01000', '00100', '00010', '00001', '00010', '00100', '01000')],
  [0x3f, glyph('01110', '10001', '00001', '00010', '00100', '00000', '00100')],
  [0x40, glyph('01110', '10001', '00001', '01101', '10101', '10101', '01110')],
  [0x41, glyph('01110', '10001', '10001', '11111', '10001', '10001', '10001')],
  [0x42, glyph('11110', '10001', '10001', '11110', '10001', '10001', '11110')],
  [0x43, glyph('01110', '10001', '10000', '10000', '10000', '10001', '01110')],
  [0x44, glyph('11100', '10010', '10001', '10001', '10001', '10010', '11100')],
  [0x45, glyph('11111', '10000', '10000', '11110', '10000', '10000', '11111')],
  [0x46, glyph('11111', '10000', '10000', '11110', '10000', '10000', '10000')],
  [0x47, glyph('01110', '10001', '10000', '10111', '10001', '10001', '01110')],
  [0x48, glyph('10001', '10001', '10001', '11111', '10001', '10001', '10001')],
  [0x49, glyph('01110', '00100', '00100', '00100', '00100', '00100', '01110')],
  [0x4a, glyph('00001', '00001', '00001', '00001', '10001', '10001', '01110')],
  [0x4b, glyph('10001', '10010', '10100', '11000', '10100', '10010', '10001')],
  [0x4c, glyph('10000', '10000', '10000', '10000', '10000', '10000', '11111')],
  [0x4d, glyph('10001', '11011', '10101', '10101', '10001', '10001', '10001')],
  [0x4e, glyph('10001', '11001', '10101', '10011', '10001', '10001', '10001')],
  [0x4f, glyph('01110', '10001', '10001', '10001', '10001', '10001', '01110')],
  [0x50, glyph('11110', '10001', '10001', '11110', '10000', '10000', '10000')],
  [0x51, glyph('01110', '10001', '10001', '10001', '10101', '10010', '01101')],
  [0x52, glyph('11110', '10001', '10001', '11110', '10100', '10010', '10001')],
  [0x53, glyph('01110', '10001', '10000', '01110', '00001', '10001', '01110')],
  [0x54, glyph('11111', '00100', '00100', '00100', '00100', '00100', '00100')],
  [0x55, glyph('10001', '10001', '10001', '10001', '10001', '10001', '01110')],
  [0x56, glyph('10001', '10001', '10001', '10001', '10001', '01010', '00100')],
  [0x57, glyph('10001', '10001', '10001', '10101', '10101', '10101', '01010')],
  [0x58, glyph('10001', '10001', '01010', '00100', '01010', '10001', '10001')],
  [0x59, glyph('10001', '10001', '01010', '00100', '00100', '00100', '00100')],
  [0x5a, glyph('11111', '00001', '00010', '00100', '01000', '10000', '11111')],
  [0x5b, glyph('01110', '01000', '01000', '01000', '01000', '01000', '01110')],
  [0x5c, glyph('10000', '01000', '00100', '00010', '00001', '00000', '00000')],
  [0x5d, glyph('01110', '00010', '00010', '00010', '00010', '00010', '01110')],
  [0x5e, glyph('00100', '01010', '10001', '00000', '00000', '00000', '00000')],
  [0x5f, glyph('00000', '00000', '00000', '00000', '00000', '00000', '11111')],
  [0x60, glyph('01000', '00100', '00010', '00000', '00000', '00000', '00000')],
  [0x7b, glyph('00010', '00100', '00100', '01000', '00100', '00100', '00010')],
  [0x7c, glyph('00100', '00100', '00100', '00100', '00100', '00100', '00100')],
  [0x7d, glyph('01000', '00100', '00100', '00010', '00100', '00100', '01000')],
  [0x7e, glyph('00000', '00000', '01001', '10110', '00000', '00000', '00000')]
]);

const FALLBACK = glyph('11111', '00001', '00010', '00100', '00100', '00000', '00100');

export function getGlyphForCode(code: number): Uint8Array {
  return GLYPHS.get(code & 0xff) ?? FALLBACK;
}
