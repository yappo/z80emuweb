import { PCG815_DISPLAY_SPEC } from './hardware-map';

export const LCD_WIDTH = PCG815_DISPLAY_SPEC.width;
export const LCD_HEIGHT = PCG815_DISPLAY_SPEC.height;
export const LCD_COLS = PCG815_DISPLAY_SPEC.textCols;
export const LCD_ROWS = PCG815_DISPLAY_SPEC.textRows;
export const LCD_GLYPH_WIDTH = PCG815_DISPLAY_SPEC.glyphWidth;
export const LCD_GLYPH_HEIGHT = PCG815_DISPLAY_SPEC.glyphHeight;
export const LCD_GLYPH_PITCH_X = PCG815_DISPLAY_SPEC.glyphPitchX;
export const LCD_GLYPH_PITCH_Y = PCG815_DISPLAY_SPEC.glyphPitchY;

function row(bits: string): number {
  return Number.parseInt(bits, 2) & 0x1f;
}

function glyph(...rows: string[]): Uint8Array {
  return Uint8Array.from(rows.map((bits) => row(bits)));
}

const GLYPHS = new Map<number, Uint8Array>([
  [0x20, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0x21, glyph('00100', '00100', '00100', '00100', '00100', '00000', '00100')],
  [0x22, glyph('01010', '01010', '01010', '00000', '00000', '00000', '00000')],
  [0x23, glyph('01010', '11111', '01010', '01010', '11111', '01010', '00000')],
  [0x24, glyph('00100', '01111', '10100', '01110', '00101', '11110', '00100')],
  [0x25, glyph('11001', '11010', '00100', '01000', '10110', '00110', '00000')],
  [0x26, glyph('01100', '10010', '10100', '01000', '10101', '10010', '01101')],
  [0x27, glyph('00100', '00100', '00010', '00000', '00000', '00000', '00000')],
  [0x28, glyph('00010', '00100', '01000', '01000', '01000', '00100', '00010')],
  [0x29, glyph('01000', '00100', '00010', '00010', '00010', '00100', '01000')],
  [0x2a, glyph('00000', '01010', '00100', '11111', '00100', '01010', '00000')],
  [0x2b, glyph('00000', '00100', '00100', '11111', '00100', '00100', '00000')],
  [0x2c, glyph('00000', '00000', '00000', '00000', '00000', '00100', '01000')],
  [0x2d, glyph('00000', '00000', '00000', '11111', '00000', '00000', '00000')],
  [0x2e, glyph('00000', '00000', '00000', '00000', '00000', '00100', '00100')],
  [0x2f, glyph('00001', '00010', '00100', '01000', '10000', '00000', '00000')],
  [0x30, glyph('01110', '10001', '10011', '10101', '11001', '10001', '01110')],
  [0x31, glyph('00100', '01100', '00100', '00100', '00100', '00100', '01110')],
  [0x32, glyph('01110', '10001', '00001', '00010', '00100', '01000', '11111')],
  [0x33, glyph('11110', '00001', '00001', '01110', '00001', '00001', '11110')],
  [0x34, glyph('00010', '00110', '01010', '10010', '11111', '00010', '00010')],
  [0x35, glyph('11111', '10000', '10000', '11110', '00001', '00001', '11110')],
  [0x36, glyph('01110', '10000', '10000', '11110', '10001', '10001', '01110')],
  [0x37, glyph('11111', '00001', '00010', '00100', '01000', '01000', '01000')],
  [0x38, glyph('01110', '10001', '10001', '01110', '10001', '10001', '01110')],
  [0x39, glyph('01110', '10001', '10001', '01111', '00001', '00001', '01110')],
  [0x3a, glyph('00000', '00100', '00100', '00000', '00100', '00100', '00000')],
  [0x3b, glyph('00000', '00100', '00100', '00000', '00100', '00100', '01000')],
  [0x3c, glyph('00010', '00100', '01000', '10000', '01000', '00100', '00010')],
  [0x3d, glyph('00000', '11111', '00000', '11111', '00000', '00000', '00000')],
  [0x3e, glyph('01000', '00100', '00010', '00001', '00010', '00100', '01000')],
  [0x3f, glyph('01110', '10001', '00001', '00010', '00100', '00000', '00100')],
  [0x40, glyph('01110', '10001', '00001', '01101', '10101', '10101', '01110')],
  [0x41, glyph('01110', '10001', '10001', '11111', '10001', '10001', '10001')],
  [0x42, glyph('11110', '10001', '10001', '11110', '10001', '10001', '11110')],
  [0x43, glyph('01110', '10001', '10000', '10000', '10000', '10001', '01110')],
  [0x44, glyph('11100', '10010', '10001', '10001', '10001', '10010', '11100')],
  [0x45, glyph('11111', '10000', '10000', '11110', '10000', '10000', '11111')],
  [0x46, glyph('11111', '10000', '10000', '11110', '10000', '10000', '10000')],
  [0x47, glyph('01110', '10001', '10000', '10111', '10001', '10001', '01110')],
  [0x48, glyph('10001', '10001', '10001', '11111', '10001', '10001', '10001')],
  [0x49, glyph('01110', '00100', '00100', '00100', '00100', '00100', '01110')],
  [0x4a, glyph('00001', '00001', '00001', '00001', '10001', '10001', '01110')],
  [0x4b, glyph('10001', '10010', '10100', '11000', '10100', '10010', '10001')],
  [0x4c, glyph('10000', '10000', '10000', '10000', '10000', '10000', '11111')],
  [0x4d, glyph('10001', '11011', '10101', '10101', '10001', '10001', '10001')],
  [0x4e, glyph('10001', '11001', '10101', '10011', '10001', '10001', '10001')],
  [0x4f, glyph('01110', '10001', '10001', '10001', '10001', '10001', '01110')],
  [0x50, glyph('11110', '10001', '10001', '11110', '10000', '10000', '10000')],
  [0x51, glyph('01110', '10001', '10001', '10001', '10101', '10010', '01101')],
  [0x52, glyph('11110', '10001', '10001', '11110', '10100', '10010', '10001')],
  [0x53, glyph('01110', '10001', '10000', '01110', '00001', '10001', '01110')],
  [0x54, glyph('11111', '00100', '00100', '00100', '00100', '00100', '00100')],
  [0x55, glyph('10001', '10001', '10001', '10001', '10001', '10001', '01110')],
  [0x56, glyph('10001', '10001', '10001', '10001', '10001', '01010', '00100')],
  [0x57, glyph('10001', '10001', '10001', '10101', '10101', '10101', '01010')],
  [0x58, glyph('10001', '10001', '01010', '00100', '01010', '10001', '10001')],
  [0x59, glyph('10001', '10001', '01010', '00100', '00100', '00100', '00100')],
  [0x5a, glyph('11111', '00001', '00010', '00100', '01000', '10000', '11111')],
  [0x5b, glyph('01110', '01000', '01000', '01000', '01000', '01000', '01110')],
  [0x5c, glyph('10000', '01000', '00100', '00010', '00001', '00000', '00000')],
  [0x5d, glyph('01110', '00010', '00010', '00010', '00010', '00010', '01110')],
  [0x5e, glyph('00100', '01010', '10001', '00000', '00000', '00000', '00000')],
  [0x5f, glyph('00000', '00000', '00000', '00000', '00000', '00000', '11111')],
  [0x60, glyph('01000', '00100', '00010', '00000', '00000', '00000', '00000')],
  [0x61, glyph('00000', '01110', '00001', '01111', '10001', '10011', '01101')],
  [0x62, glyph('10000', '10000', '10110', '11001', '10001', '11001', '10110')],
  [0x63, glyph('00000', '01110', '10001', '10000', '10000', '10001', '01110')],
  [0x64, glyph('00001', '00001', '01101', '10011', '10001', '10011', '01101')],
  [0x65, glyph('00000', '01110', '10001', '11111', '10000', '10001', '01110')],
  [0x66, glyph('00110', '01001', '01000', '11100', '01000', '01000', '01000')],
  [0x67, glyph('00000', '01101', '10011', '10011', '01101', '00001', '01110')],
  [0x68, glyph('10000', '10000', '10110', '11001', '10001', '10001', '10001')],
  [0x69, glyph('00100', '00000', '01100', '00100', '00100', '00100', '01110')],
  [0x6a, glyph('00010', '00000', '00110', '00010', '00010', '10010', '01100')],
  [0x6b, glyph('10000', '10000', '10010', '10100', '11000', '10100', '10010')],
  [0x6c, glyph('01100', '00100', '00100', '00100', '00100', '00100', '01110')],
  [0x6d, glyph('00000', '11010', '10101', '10101', '10101', '10101', '10101')],
  [0x6e, glyph('00000', '10110', '11001', '10001', '10001', '10001', '10001')],
  [0x6f, glyph('00000', '01110', '10001', '10001', '10001', '10001', '01110')],
  [0x70, glyph('00000', '10110', '11001', '11001', '10110', '10000', '10000')],
  [0x71, glyph('00000', '01101', '10011', '10011', '01101', '00001', '00001')],
  [0x72, glyph('00000', '10110', '11001', '10000', '10000', '10000', '10000')],
  [0x73, glyph('00000', '01111', '10000', '01110', '00001', '00001', '11110')],
  [0x74, glyph('01000', '01000', '11100', '01000', '01000', '01001', '00110')],
  [0x75, glyph('00000', '10001', '10001', '10001', '10011', '10101', '01001')],
  [0x76, glyph('00000', '10001', '10001', '10001', '10001', '01010', '00100')],
  [0x77, glyph('00000', '10001', '10001', '10101', '10101', '10101', '01010')],
  [0x78, glyph('00000', '10001', '01010', '00100', '01010', '10001', '00000')],
  [0x79, glyph('00000', '10001', '10001', '10011', '01101', '00001', '01110')],
  [0x7a, glyph('00000', '11111', '00010', '00100', '01000', '10000', '11111')],
  [0x7b, glyph('00010', '00100', '00100', '01000', '00100', '00100', '00010')],
  [0x7c, glyph('00100', '00100', '00100', '00100', '00100', '00100', '00100')],
  [0x7d, glyph('01000', '00100', '00100', '00010', '00100', '00100', '01000')],
  [0x7e, glyph('00000', '00000', '01001', '10110', '00000', '00000', '00000')],
  [0x80, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0x81, glyph('11111', '11111', '11111', '11111', '11111', '11111', '00000')],
  [0x82, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x83, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x84, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x85, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x86, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x87, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x88, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x89, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x8a, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x8b, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x8c, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x8d, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x8e, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x8f, glyph('00000', '00000', '00000', '00100', '00000', '00000', '00000')],
  [0x90, glyph('00000', '00000', '00000', '00000', '00000', '00000', '11111')],
  [0x91, glyph('11111', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0x92, glyph('00000', '00001', '00001', '00001', '00001', '00001', '00000')],
  [0x93, glyph('00000', '10000', '10000', '10000', '10000', '10000', '00000')],
  [0x94, glyph('00000', '11111', '11111', '11111', '11111', '11111', '00000')],
  [0x95, glyph('00000', '00000', '11111', '11111', '11111', '00000', '00000')],
  [0x96, glyph('01110', '01110', '01110', '01110', '01110', '01110', '01110')],
  [0x97, glyph('11111', '11111', '11111', '11111', '11111', '11111', '11111')],
  [0x98, glyph('11111', '10000', '10000', '10000', '10000', '10000', '00000')],
  [0x99, glyph('11111', '00001', '00001', '00001', '00001', '00001', '00000')],
  [0x9a, glyph('00000', '10000', '10000', '10000', '10000', '10000', '11111')],
  [0x9b, glyph('00000', '00001', '00001', '00001', '00001', '00001', '11111')],
  [0x9c, glyph('00011', '00111', '01110', '01100', '11000', '11000', '11000')],
  [0x9d, glyph('11000', '11100', '01110', '00110', '00011', '00011', '00011')],
  [0x9e, glyph('11000', '11000', '11000', '01100', '01110', '00111', '00011')],
  [0x9f, glyph('00011', '00011', '00011', '00110', '01110', '11100', '11000')],
  [0xa0, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0xa1, glyph('00100', '01110', '11011', '11011', '11011', '01110', '00100')],
  [0xa2, glyph('11111', '11000', '11000', '11000', '11000', '11000', '11000')],
  [0xa3, glyph('00011', '00011', '00011', '00011', '00011', '00011', '11111')],
  [0xa4, glyph('00000', '11000', '01100', '01110', '00111', '00011', '00000')],
  [0xa5, glyph('00000', '01110', '11111', '11111', '11111', '01110', '00100')],
  [0xa6, glyph('11111', '00001', '11111', '00010', '00010', '00100', '11000')],
  [0xa7, glyph('00000', '00000', '01111', '00001', '00110', '00100', '01000')],
  [0xa8, glyph('00000', '00000', '00001', '00010', '00100', '01010', '00010')],
  [0xa9, glyph('00000', '00000', '00100', '11111', '10001', '00010', '00100')],
  [0xaa, glyph('00000', '00000', '00000', '01110', '00100', '00100', '11111')],
  [0xab, glyph('00000', '00000', '00010', '01111', '00110', '01010', '10010')],
  [0xac, glyph('00000', '00000', '01000', '11111', '01001', '01010', '01000')],
  [0xad, glyph('00000', '00000', '01110', '00010', '00010', '01111', '00000')],
  [0xae, glyph('00000', '00000', '01110', '00010', '01110', '00010', '01110')],
  [0xaf, glyph('00000', '00000', '00000', '10101', '10101', '00001', '01110')],
  [0xb0, glyph('11111', '11111', '11111', '11111', '11111', '11111', '00000')],
  [0xb1, glyph('11111', '00001', '00101', '00110', '00100', '01000', '10000')],
  [0xb2, glyph('00001', '00011', '00110', '01110', '10010', '00010', '00010')],
  [0xb3, glyph('00100', '11111', '10001', '10001', '00011', '00110', '01100')],
  [0xb4, glyph('11111', '00100', '00100', '00100', '00100', '00100', '11111')],
  [0xb5, glyph('00010', '11111', '00110', '00110', '01010', '10010', '00110')],
  [0xb6, glyph('00100', '01111', '00101', '00101', '01001', '01001', '10110')],
  [0xb7, glyph('00100', '01111', '11100', '00100', '11111', '00100', '00100')],
  [0xb8, glyph('00111', '01001', '11001', '10010', '00010', '00100', '01000')],
  [0xb9, glyph('01000', '01111', '01010', '10010', '00100', '00100', '01000')],
  [0xba, glyph('11111', '00001', '00001', '00001', '00001', '00001', '11111')],
  [0xbb, glyph('01010', '01010', '11111', '01010', '00010', '00100', '00100')],
  [0xbc, glyph('01000', '00101', '10001', '01001', '00010', '00100', '01000')],
  [0xbd, glyph('11110', '00010', '00010', '00100', '00110', '01001', '10001')],
  [0xbe, glyph('01000', '01001', '11111', '01001', '01010', '01000', '00111')],
  [0xbf, glyph('10001', '10001', '01001', '00010', '00010', '00100', '01000')],
  [0xc0, glyph('00111', '01001', '11001', '10110', '00010', '00100', '01000')],
  [0xc1, glyph('00010', '01100', '00100', '11111', '00100', '01100', '11000')],
  [0xc2, glyph('00001', '10101', '10101', '00001', '00010', '00100', '01000')],
  [0xc3, glyph('01110', '00000', '11111', '00100', '00100', '01000', '01000')],
  [0xc4, glyph('10000', '10000', '11000', '11111', '10000', '10000', '10000')],
  [0xc5, glyph('00100', '00100', '11111', '00100', '00100', '01000', '01000')],
  [0xc6, glyph('11111', '00000', '00000', '00000', '00000', '00000', '11111')],
  [0xc7, glyph('11111', '00001', '01001', '00110', '00110', '01101', '11000')],
  [0xc8, glyph('00100', '11110', '00010', '00110', '01111', '00100', '00100')],
  [0xc9, glyph('00001', '00001', '00011', '00010', '00110', '01100', '11000')],
  [0xca, glyph('00010', '01010', '01010', '01001', '01001', '10001', '10000')],
  [0xcb, glyph('10000', '10000', '11110', '11000', '10000', '10000', '01111')],
  [0xcc, glyph('11111', '00001', '00001', '00010', '00010', '00100', '01000')],
  [0xcd, glyph('01000', '01100', '01100', '10010', '10010', '00001', '00001')],
  [0xce, glyph('00100', '11111', '00100', '00100', '10101', '10101', '00100')],
  [0xcf, glyph('11111', '00001', '00010', '01010', '00100', '00110', '00010')],
  [0xd0, glyph('11111', '00000', '01100', '00110', '00000', '11110', '00011')],
  [0xd1, glyph('00100', '00100', '01000', '01010', '01010', '11111', '11001')],
  [0xd2, glyph('00000', '00010', '01110', '00110', '00111', '01001', '10000')],
  [0xd3, glyph('11111', '00100', '01100', '11111', '00000', '00100', '00111')],
  [0xd4, glyph('01000', '01011', '11101', '01011', '00010', '00100', '00100')],
  [0xd5, glyph('01110', '00010', '00010', '00010', '00010', '00010', '11111')],
  [0xd6, glyph('11111', '00001', '00001', '11111', '00001', '00001', '11111')],
  [0xd7, glyph('01110', '00000', '11111', '00001', '00011', '00110', '01100')],
  [0xd8, glyph('10001', '10001', '10001', '10001', '00011', '00110', '01100')],
  [0xd9, glyph('00100', '01100', '01100', '01101', '01101', '10110', '10000')],
  [0xda, glyph('10000', '10000', '10000', '10001', '10010', '11100', '11000')],
  [0xdb, glyph('11111', '10001', '10001', '10001', '10001', '10001', '11111')],
  [0xdc, glyph('11111', '10001', '10001', '00001', '00010', '00110', '01000')],
  [0xdd, glyph('10000', '01001', '00001', '00010', '00010', '01100', '11000')],
  [0xde, glyph('00000', '00110', '11110', '01011', '01111', '01100', '00000')],
  [0xdf, glyph('00100', '01110', '11011', '11011', '11011', '01110', '01100')],
  [0xe0, glyph('11111', '11111', '00000', '00000', '00000', '11111', '11111')],
  [0xe1, glyph('10000', '11000', '11111', '10000', '11111', '11000', '10000')],
  [0xe2, glyph('00100', '00100', '11111', '00100', '11111', '00100', '00100')],
  [0xe3, glyph('00001', '00011', '11111', '00001', '11111', '00011', '00001')],
  [0xe4, glyph('00000', '00001', '00011', '00111', '00111', '01111', '11111')],
  [0xe5, glyph('00000', '10000', '11000', '11100', '11100', '11110', '11111')],
  [0xe6, glyph('11111', '11110', '11100', '11100', '11000', '10000', '00000')],
  [0xe7, glyph('11111', '01111', '00111', '00111', '00011', '00001', '00000')],
  [0xe8, glyph('00000', '00100', '01110', '11111', '11111', '11111', '00100')],
  [0xe9, glyph('11110', '11111', '11111', '11111', '01110', '00100', '00000')],
  [0xea, glyph('00100', '00100', '01110', '11111', '01110', '00100', '00100')],
  [0xeb, glyph('00100', '01110', '01110', '11111', '11111', '00100', '00100')],
  [0xec, glyph('01110', '11111', '11111', '11111', '11111', '11111', '01110')],
  [0xed, glyph('01110', '10001', '10001', '10001', '10001', '10001', '01110')],
  [0xee, glyph('00001', '00000', '00010', '00100', '01000', '00000', '10000')],
  [0xef, glyph('10000', '00000', '01000', '00100', '00010', '00000', '00001')],
  [0xf0, glyph('10001', '11011', '01110', '00100', '01110', '11011', '10001')],
  [0xf1, glyph('11111', '10101', '10101', '11111', '10001', '10001', '10011')],
  [0xf2, glyph('01000', '01111', '11110', '01100', '11111', '00100', '00100')],
  [0xf3, glyph('01111', '01001', '01111', '01001', '01111', '10001', '10011')],
  [0xf4, glyph('11111', '10001', '10001', '11111', '10001', '10001', '11111')],
  [0xf5, glyph('10010', '11110', '11111', '11011', '11111', '11100', '00010')],
  [0xf6, glyph('01010', '01010', '11011', '01110', '00010', '01010', '10110')],
  [0xf7, glyph('11000', '01010', '11111', '11010', '11011', '01010', '01100')],
  [0xf8, glyph('01101', '01111', '01011', '01010', '11110', '10110', '10100')],
  [0xf9, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0xfa, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0xfb, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0xfc, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0xfd, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0xfe, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')],
  [0xff, glyph('00000', '00000', '00000', '00000', '00000', '00000', '00000')]
]);

const FALLBACK = glyph('11111', '00001', '00010', '00100', '00100', '00000', '00100');

function resolveGlyph(code: number): Uint8Array | undefined {
  const normalized = code & 0xff;
  return GLYPHS.get(normalized);
}

export function hasGlyphForCode(code: number): boolean {
  return resolveGlyph(code) !== undefined;
}

export function getGlyphForCode(code: number): Uint8Array {
  return resolveGlyph(code) ?? FALLBACK;
}
